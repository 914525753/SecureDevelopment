<!DOCTYPE html>
<html>
	<head>
		<meta charset = "utf-8"></meta>
		<title>IdSql</title>
		<link rel = "stylesheet" type = "text/css" href = "css/normal.css"></link>
		<script type = "text/javascript" src = "http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script> <!--jquery-->
		<script type = "text/javascript" src = "js/publicfunc.js" async = "async"></script>
	</head>
	<body onload = "PostID()">
		<div class = "Code">
			<pre>
&lt;php
	$id = (!isset($_GET["id"]))?1:$_GET["id"] ;
	$conn = mysqli_connect("127.0.0.1","root","","Secure_Development");
	$sql = "select * from news where id = '$id'";
	$result = mysqli_query($conn, $sql);
	echo "&lt;table&gt;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;";
        echo "&lt;th&gt;username&lt;/th&gt;&lt;/tr&gt;";
        if ($result->num_rows > 0) 
        {
            while($row = $result->fetch_assoc())
            {
                echo "&lt;tr&gt;&lt;td&gt;$row[id]&lt;/td&gt;";
                echo "&lt;td&gt;$row[username]&lt;/td&gt;&lt;/tr&gt;";
            }
        }
		echo "&lt;/table&gt;";
		$result -> free();
        $conn -> close();
?&gt;
			</pre>
		</div>
		<div class = "Challenge">
				<span id = "Notice2"></span>
			<HR>
			<br>
			<form action = "#" method = "post" name = "FormSubmit" id = "FormSubmit">
				<h1>登录</h1>
				<p>用户名：<input name = "username" type = "textarea"></input></p>
				<p>&nbsp;&nbsp;密码：&nbsp;<input name = "password" type = "password"></input></p>
				<input id = "Submit" type = "submit" value = "submit"></input>
				<p id = "Tip">Tip:本关使用的表是news</p>
			</form>
			<span id = "Flag">
				<span id = "Notice"></span>
				<p>FLAG：<input name = "Flag" type = "textarea" id = "Flag"></input>&nbsp;&nbsp;<input id = "Submit2" type = "submit" value = "submit" onclick = "GetFlag()"></input></p>
			</span>
		</div>
		<br>
		<div class = "Success">
			<p>该程序的漏洞为，变量$id在传入sql的时候没有做相应的过滤，直接拼接到sql语句中，造成sql注入</p>
			<p>将变量id强制转换为整形变量，防止注入</p>
			<pre>
$id = (!isset($_GET["id"]))?1:$_GET["id"] ;
$id = (int)$id;
			</pre>
			<input type = "submit" onclick = "window.location.href = 'ImgXss.html'" value = "下一关"></input>
		</div>
	</body>
</html>